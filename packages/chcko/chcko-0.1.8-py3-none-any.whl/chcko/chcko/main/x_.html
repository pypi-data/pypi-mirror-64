% if not defined('header'):
% def header():

    %for page, txt in [('edits',tedit),('content',tcontent),('done',tdone),('todo',ttodo),('roles',troles)]:
    <div class="grid_2"
        %if request.pagename == page:
        style="text-align:center;border-bottom:1px solid;background-color:{{rolecolor}}"
        %else:
        style="text-align:center"
        %end
        >
        %if request.user is None and page=='roles':
            <p> &nbsp;</p>
        %else:
            <p><a href="/{{request.lang}}/{{page}}">{{txt}}</a></p>
        %end
    </div>
    %end

    <div class="header" style="background-color:{{rolecolor}}">

    %if request.user:
        %for key2prnt,is_users in db.key_ownd_path(request.student,request.user):
        <div class="grid_2">
            %if key2prnt.kind()=='Student':
            <ul id="nav">
                {{util.translate(key2prnt.kind())}}<br>
                <li>
                %addqs = lambda x: request.query_string+'&'+x if request.query_string else x
                <a href="/{{request.lang}}/{{request.pagename}}?{{! addqs(db.urlstring(key2prnt)) }}">
                    {{key2prnt.string_id()}} </a>
                <ul style="text-align:right">
                    %for key_ownd_list in db.userroles(request.user):
                    %studentkey = key_ownd_list[-1][0]
                    <li>
                    <a
                    style="background-color:{{studentkey.get().color}}"
                    href="/{{request.lang}}/{{request.pagename}}?{{! addqs(db.urlstring(studentkey)) }}">
                        %cntxt = [not ownd and '<em>'+an.string_id()+'</em>' or an.string_id() for an,ownd in key_ownd_list]
                        {{!' &nbsp;&nbsp; '.join(cntxt)}}
                    </a>
                    <li>
                    %end
                </ul></li>
                </li>
            </ul>
            %else:
                {{util.translate(key2prnt.kind())}}<br>
                %if not is_users:
                    <em>{{key2prnt.string_id()}}</em>
                %else:
                    {{key2prnt.string_id()}}
                %end
            %end
        </div>
        %end
    %else:
        %for key2prnt,is_users in db.key_ownd_path(request.student,None):
            %if key2prnt.kind()=='Student':
            <div class="grid_2" style="text-align:right">
            %else:
            <div class="grid_2">
            %end
            {{util.translate(key2prnt.kind())}}<br>
            %if not is_users:
                <em>{{key2prnt.string_id()}}</em>
            %else:
                {{key2prnt.string_id()}}
            %end
        </div>
        %end
    %end

    <div class='clear'>&nbsp;</div>
    </div>

% end
% end

% if not defined('footer'):
% def footer():

    % if request.user:

    <div class="footer" style="border-top:double;background-color:{{rolecolor}}">
    <div class="grid_10">
        {{ db.user_name(request.user) }}
        &nbsp;
        <a href="/{{request.lang}}/logout">{{ tlogout }} </a>
        &nbsp;
        %if not db.is_social_login(request.user):
            <a href="/{{request.lang}}/password">{{ tchangepassword }} </a>
        %end
    </div> 
    </div>

    % elif request.pagename not in ['login','forgot','verification','password']:

    <div class="footer" style="border-top:double;background-color:{{rolecolor}}">
    <div class="grid_10">
        {{ tloginat }}
    </div> 
    </div>

    <div class="footer" style="background-color:{{rolecolor}}">
        <div class="grid_2">
        <a href="/{{request.lang}}/login">chcko</a>
        %if len(social_logins)>0:
        {{ torvia }}
        </div> 
            %for social in social_logins.keys():
        <div class="grid_2"> 
        <a href="/auth/{{ social }}">{{ social }}</a>
        </div> 
            %end
        %end
    </div>

    %end


    <div class="footer" style="background-color:{{rolecolor}}"> &nbsp; </div>

    <div class="grid_10">
        {{tdevelopment}} <a href="https://github.com/chcko/chcko">Github</a>
    </div>

    <div class="footer" style="background-color:{{rolecolor}}"> &nbsp; </div>

    <div class="grid_10">
        %for lng in langs:
        {{!util.newlang(lng)}} &nbsp;
        %end
    </div>

    </div>

% end
% end

% if not defined('title'):
% def title():
    % if request.user:
        {{db.user_name(request.user)}}
    % else:
        chcko
    % end
% end
% end

<!doctype html>
<html>
<head>
    <!--<link href="/static/reset.css" rel="stylesheet" type="text/css"/>-->
    <link href="/static/960.css?column_width=0&column_amount=10&gutter_width=0" media="screen" rel="stylesheet" type="text/css" />
    <link href="/static/main.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/pygments.css" type="text/css" />

    <!-- mathjax
     -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- katex is faster, but cannot render e.g. r.ch (\begin{split}\begin{matrix})
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

    <%
    if defined('scripts'):
        for n,js in sorted(scripts.items()):
           js()
        end
    end
    %>

    % if request.user:
    <style>
    ul#nav {
        display: inline;
        margin: 0;
        padding: 0;
        list-style: none;
        width:auto;
        float:right;
    }
    ul#nav>li {
        position: relative;
        width:auto;
        float:left;
        clear:left;
    }
    ul#nav>li>ul {
        display: none;
        list-style: none;
        position: absolute;
        top: 0;
        min-height:0;
    }
    ul#nav li a {
        display:block;
        text-decoration: none;
        line-height:2em;
        height:2em;	
        padding:0 5px;
        width:290%;
        border: 1px solid;
        margin-top:-1px;
        background-color: {{rolecolor}};
    }
    ul#nav>li>a {
        line-height:auto;
        height:auto;	
        padding:0;
        width:auto;
        border:none;
    }
    ul#nav li a:hover { 
        text-decoration: underline;
    }

    ul#nav>li:hover>ul{
        margin-top:2em;
        display: block;
        width:auto;
        z-index:999;
    } 
    </style>

    <script>
    sizemenu = function(){
            var vwidth = $(".container_10").width();
            $("#nav>li>ul>li>a").width(vwidth);
            $("#nav>li>ul").css("margin-left",0.5*$("#nav>li>a").width()-vwidth+"px");
            }
    $(document).ready(sizemenu);
    $(window).bind("resize",sizemenu);
    //FIXME:
    //content on back button previously checked checkbox will be checked. don't know how to avoid this
    //does not work: window.onbeforeunload = function() { $("input:checked").removeAttr("checked");};
    </script>

    % end

    <title> 
        % title()
    </title>
</head>
<body >

    <div class="container_10">

    % header()

    <div class="grid_10" style="padding-top:1em;">
    {{!base}}
    <p>&nbsp;</p>
    </div>

    % footer()
    </div>

</body>
</html>


