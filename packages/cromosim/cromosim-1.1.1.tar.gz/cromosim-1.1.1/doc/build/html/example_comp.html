
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Discover the compartment model &#8212; cromosim  documentation</title>
    
    <link rel="stylesheet" href="_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/theme_extras.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Domain class used to build the computational domain" href="domain.html" />
    <link rel="prev" title="Make a microscopic simulation" href="example_micro.html" /> 
  </head><body>
    <div id="content">
      <div class="header">
        <h1 class="heading"><a href="index.html"
          title="back to the documentation overview"><span>Discover the compartment model</span></a></h1>
      </div>
      <div class="relnav" role="navigation" aria-label="related navigation">
        <a href="example_micro.html">&laquo; Make a microscopic simulation</a> |
        <a href="#">Discover the compartment model</a>
        | <a href="domain.html">Domain class used to build the computational domain &raquo;</a>
      </div>
      <div id="contentwrapper">
        <div role="main">
        
  <div class="section" id="discover-the-compartment-model">
<h1>Discover the compartment model<a class="headerlink" href="#discover-the-compartment-model" title="Permalink to this headline">Â¶</a></h1>
<p>The models presented in this chapter are fundamentally different from all the other
models in this book.
This class of model does not aim at computing positions and velocities,
but rather at describing the evolution of total amounts of people in specified
compartments. The compartments shall be identified to nodes of a network, those
nodes are connected by edges, which corresponds to paths between nodes.</p>
<p>Reference : <a class="reference internal" href="index.html#mf2018" id="id1"><span>[MF2018]</span></a> Chapter 6.</p>
<p>A compartment model example can be found in the directory</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">cromosim</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">compartments</span><span class="o">/</span>
</pre></div>
</div>
<p>and can be run with:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">compartments</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">json</span> <span class="nb">input</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Results:</p>
<br>
<br>
<video style="display:block; margin: 0 auto;" controls poster="_static/compartments.png" width="50%" height="auto">
   <source src="_static/compartments.mp4" />
   <source src="_static/compartments.webm" />
   <source src="_static/compartments.theora.ogv" />
</video>
<br>
<div align=center>
  <i>Compartment model : evacuation</i>
</div>
<br>
<br><p>Code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">cromosim</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">compartments</span><span class="o">/</span><span class="n">compartments</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors:</span>
<span class="c1">#     Sylvain Faure &lt;sylvain.faure@math.u-psud.fr&gt;</span>
<span class="c1">#     Bertrand Maury &lt;bertrand.maury@math.u-psud.fr&gt;</span>
<span class="c1">#</span>
<span class="c1">#      cromosim/examples/compartments/compartments.py</span>
<span class="c1">#      python compartments.py --json input.json</span>
<span class="c1">#</span>
<span class="c1"># License: GPL</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">cromosim</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">cromosim.comp</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    python3 compartments.py --json input.json</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="s2">&quot;usage: %prog [options] filename&quot;</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;%prog 1.0&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s1">&#39;--json&#39;</span><span class="p">,</span><span class="n">dest</span><span class="o">=</span><span class="s2">&quot;jsonfilename&quot;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;input.json&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
                  <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;Input json filename&quot;</span><span class="p">)</span>
<span class="n">opt</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; JSON filename = &quot;</span><span class="p">,</span><span class="n">opt</span><span class="o">.</span><span class="n">jsonfilename</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">jsonfilename</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get parameters from json file :</span>

<span class="sd">    name: string</span>
<span class="sd">        Domain name</span>
<span class="sd">    prefix: string</span>
<span class="sd">        Folder name to store the results</span>
<span class="sd">    background: string</span>
<span class="sd">        Image file used as background</span>
<span class="sd">    px: float</span>
<span class="sd">        Pixel size in meters (also called space step)</span>
<span class="sd">    width: integer</span>
<span class="sd">        Domain width (equal to the width of the background image)</span>
<span class="sd">    height: integer</span>
<span class="sd">        Domain height (equal to the height of the background image)</span>
<span class="sd">    wall_lines : list of numpy arrays</span>
<span class="sd">        Polylines used to build walls, [ [[x0,x1,x2,...],[y0,y1,y2,...]],... ]</span>
<span class="sd">    wall_ellipses : list of numpy arrays</span>
<span class="sd">        Ellipses used to build walls, [ [x_center,y_center, width, height, \</span>
<span class="sd">        angle_in_degrees_anti-clockwise],... ]</span>
<span class="sd">    wall_polygons : list of numpy arrays</span>
<span class="sd">        Polygons used to build walls, [ [[x0,x1,x2,...],[y0,y1,y2,...]],... ]</span>
<span class="sd">    door_lines: list of numpy arrays</span>
<span class="sd">        Polylines used to build doors, [ [[x0,x1,x2,...],[y0,y1,y2,...]],... ]</span>
<span class="sd">    seed: integer</span>
<span class="sd">        Random seed which can be used to reproduce a random selection if &gt;0</span>
<span class="sd">    Np_rooms: integer</span>
<span class="sd">        Number of persons per rooms</span>
<span class="sd">    area : float</span>
<span class="sd">    Nrooms</span>
<span class="sd">    RoomNames</span>
<span class="sd">    RoomInlets</span>
<span class="sd">    DoorCenters</span>
<span class="sd">    RoomCenters</span>
<span class="sd">    DoorRoomCapacity</span>
<span class="sd">    Nsecondes</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;prefix&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<span class="n">background</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span>
<span class="n">px</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;px&quot;</span><span class="p">]</span>
<span class="n">width</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
<span class="n">height</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
<span class="n">wall_lines</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;wall_lines&quot;</span><span class="p">]</span>
<span class="n">wall_ellipses</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;wall_ellipses&quot;</span><span class="p">]</span>
<span class="n">wall_polygons</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;wall_polygons&quot;</span><span class="p">]</span>
<span class="n">door_lines</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;door_lines&quot;</span><span class="p">]</span>
<span class="n">seed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span>
<span class="n">Np_rooms</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;Np_rooms&quot;</span><span class="p">]</span>
<span class="n">area</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span>
<span class="n">RoomNames</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;RoomNames&quot;</span><span class="p">]</span>
<span class="n">Np_rooms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;Np_rooms&quot;</span><span class="p">])</span>
<span class="n">RoomInlets</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;RoomInlets&quot;</span><span class="p">]</span>
<span class="n">TravelTimeWeights</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;TravelTimeWeights&quot;</span><span class="p">]</span>
<span class="n">DoorCenters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;DoorCenters&quot;</span><span class="p">])</span>
<span class="n">RoomCenters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;RoomCenters&quot;</span><span class="p">])</span>
<span class="n">CircAngles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;CircAngles&quot;</span><span class="p">])</span>
<span class="n">DoorRoomCapacity</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;DoorRoomCapacity&quot;</span><span class="p">]</span>
<span class="n">Nsecondes</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;Nsecondes&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Number of persons per rooms : &quot;</span><span class="p">,</span><span class="n">Np_rooms</span><span class="p">)</span>
<span class="n">Np</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Np_rooms</span><span class="p">:</span>
    <span class="n">Np</span> <span class="o">+=</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Number of persons : &quot;</span><span class="p">,</span><span class="n">Np</span><span class="p">)</span>
<span class="n">Nrooms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RoomNames</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Number of rooms : &quot;</span><span class="p">,</span><span class="n">Nrooms</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Capacity of each exit door : &quot;</span><span class="p">,</span><span class="n">DoorRoomCapacity</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build the Domain</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">## To create an Domain object</span>
<span class="k">if</span> <span class="p">(</span><span class="n">background</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">pixel_size</span><span class="o">=</span><span class="n">px</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">,</span> <span class="n">pixel_size</span><span class="o">=</span><span class="n">px</span><span class="p">)</span>
<span class="c1">## To add lines : Line2D(xdata, ydata, linewidth)</span>
<span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">wall_lines</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c1">## To add ellipses : Ellipse( (x_center,y_center), width, height,</span>
<span class="c1">##                             angle_in_degrees_anti-clockwise )</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">wall_ellipses</span><span class="p">:</span>
    <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
<span class="c1">## To add polygons : Polygon( xy )</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">wall_polygons</span><span class="p">:</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
<span class="c1">## To add doors :</span>
<span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">door_lines</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dom</span><span class="o">.</span><span class="n">add_door</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c1">## To build the domain : background + shapes</span>
<span class="n">dom</span><span class="o">.</span><span class="n">build_domain</span><span class="p">()</span>
<span class="c1">## To compute the distance to the walls</span>
<span class="n">dom</span><span class="o">.</span><span class="n">compute_wall_distance</span><span class="p">()</span>
<span class="c1">## To compute the desired velocity</span>
<span class="n">dom</span><span class="o">.</span><span class="n">compute_desired_velocity</span><span class="p">()</span>
<span class="c1">## To show the domain dimensions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Domain : &quot;</span><span class="p">,</span><span class="n">dom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Wall lines : &quot;</span><span class="p">,</span><span class="n">wall_lines</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Door lines : &quot;</span><span class="p">,</span><span class="n">door_lines</span><span class="p">)</span>


<span class="c1">## Maximal number of inlets for a room</span>
<span class="n">NiorMax</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">## Number of inlets for each room</span>
<span class="n">Nior</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="n">RoomInlets</span><span class="p">:</span>
    <span class="n">NiorMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">NiorMax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ri</span><span class="p">))</span>
    <span class="n">Nior</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ri</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Maximal number of inlets for a room : &quot;</span><span class="p">,</span><span class="n">NiorMax</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Number of inlets for each room : &quot;</span><span class="p">,</span><span class="n">Nior</span><span class="p">)</span>

<span class="c1">## Room numbers associate to the inlets for each room</span>
<span class="n">List_iOr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nrooms</span><span class="p">,</span><span class="n">NiorMax</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ri</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RoomInlets</span><span class="p">):</span>
    <span class="n">List_iOr</span><span class="p">[</span><span class="n">i</span><span class="p">,:</span><span class="nb">len</span><span class="p">(</span><span class="n">ri</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ri</span>
<span class="c1">#print(&quot;===&gt; Room numbers associate to the inlets for each room&quot;,List_iOr)</span>

<span class="c1">## Compute travel times :</span>
<span class="n">T_iOr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nrooms</span><span class="p">,</span><span class="n">NiorMax</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nrooms</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nior</span><span class="p">[</span><span class="n">ir</span><span class="p">]):</span>
        <span class="n">jr</span> <span class="o">=</span> <span class="n">List_iOr</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ij_exit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">DoorCenters</span><span class="p">[</span><span class="n">ir</span><span class="p">,:</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">px</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ij_entrance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">DoorCenters</span><span class="p">[</span><span class="n">jr</span><span class="p">,:</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">px</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">T_iOr</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> \
                      <span class="n">dom</span><span class="o">.</span><span class="n">door_distance</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ij_entrance</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ij_entrance</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> \
                      <span class="n">dom</span><span class="o">.</span><span class="n">door_distance</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ij_exit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ij_exit</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">)</span>
        <span class="n">T_iOr</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">TravelTimeWeights</span><span class="p">[</span><span class="n">ir</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">T_iOr</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travel times : &quot;</span><span class="p">,</span><span class="n">T_iOr</span><span class="p">)</span>

<span class="n">NPrir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nrooms</span><span class="p">,</span><span class="n">NiorMax</span><span class="p">])</span>

<span class="c1">## Number of persons for each room</span>
<span class="n">NPir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nsecondes</span> <span class="p">,</span> <span class="n">Nrooms</span><span class="p">])</span>
<span class="n">NPir</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">Np_rooms</span>

<span class="c1">## Number of persons who&#39;s waiting to leave each room</span>
<span class="n">NPwir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nsecondes</span> <span class="p">,</span> <span class="n">Nrooms</span><span class="p">])</span>
<span class="n">NPwir</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="n">NPir</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>

<span class="c1">## Nrooms of persons upstream the exit</span>
<span class="n">Flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nsecondes</span> <span class="p">,</span> <span class="n">Nrooms</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; NPir at t=0 : &quot;</span><span class="p">,</span><span class="n">NPir</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">it</span><span class="o">=</span><span class="mi">0</span>
<span class="n">plot_compt</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">RoomNames</span><span class="p">,</span> <span class="n">RoomCenters</span><span class="p">,</span> <span class="n">DoorCenters</span><span class="p">,</span> <span class="n">CircAngles</span><span class="p">,</span> <span class="n">NPir</span><span class="p">[</span><span class="n">it</span><span class="p">,:],</span>
           <span class="n">NPrir</span><span class="p">,</span> <span class="n">NPwir</span><span class="p">[</span><span class="n">it</span><span class="p">,:],</span> <span class="n">Nior</span><span class="p">,</span> <span class="n">List_iOr</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">filename</span><span class="o">=</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;fig_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
           <span class="n">title</span><span class="o">=</span><span class="s1">&#39;time = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; s&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Nsecondes</span><span class="p">):</span>

    <span class="n">Flux</span><span class="p">,</span><span class="n">NPir</span><span class="p">,</span><span class="n">NPwir</span><span class="p">,</span><span class="n">NPrir</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">Nrooms</span><span class="p">,</span> <span class="n">DoorRoomCapacity</span><span class="p">,</span> <span class="n">NPir</span><span class="p">,</span> <span class="n">NPrir</span><span class="p">,</span>
                                      <span class="n">NPwir</span><span class="p">,</span> <span class="n">Nior</span><span class="p">,</span> <span class="n">List_iOr</span><span class="p">,</span> <span class="n">T_iOr</span><span class="p">,</span> <span class="n">Flux</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------&gt; it = &quot;</span><span class="p">,</span><span class="n">it</span><span class="p">)</span>
    <span class="c1">#print(&quot;--&gt; Flux : &quot;,Flux)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; NPir : &quot;</span><span class="p">,</span><span class="n">NPir</span><span class="p">[</span><span class="n">it</span><span class="p">,:])</span>
    <span class="c1">#print(&quot;--&gt; NPwir : &quot;,NPwir[it,:])</span>
    <span class="c1">#print(&quot;--&gt; NPrir : &quot;,NPrir)</span>
    <span class="n">plot_compt</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">RoomNames</span><span class="p">,</span> <span class="n">RoomCenters</span><span class="p">,</span> <span class="n">DoorCenters</span><span class="p">,</span> <span class="n">CircAngles</span><span class="p">,</span> <span class="n">NPir</span><span class="p">[</span><span class="n">it</span><span class="p">,:],</span>
               <span class="n">NPrir</span><span class="p">,</span> <span class="n">NPwir</span><span class="p">[</span><span class="n">it</span><span class="p">,:],</span> <span class="n">Nior</span><span class="p">,</span> <span class="n">List_iOr</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">filename</span><span class="o">=</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;fig_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s1">&#39;time = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; s&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>


        </div>
      </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Sylvain Faure, Bertrand Maury.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>