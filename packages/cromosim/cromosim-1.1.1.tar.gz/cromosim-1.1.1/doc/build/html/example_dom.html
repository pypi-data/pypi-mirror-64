
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Build a domain &#8212; cromosim  documentation</title>
    
    <link rel="stylesheet" href="_static/scrolls.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/theme_extras.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Understand one-dimensional microscopic models : the Follow-the-Leader model" href="example_ftl.html" />
    <link rel="prev" title="Welcome to cromosim’s documentation!" href="index.html" /> 
  </head><body>
    <div id="content">
      <div class="header">
        <h1 class="heading"><a href="index.html"
          title="back to the documentation overview"><span>Build a domain</span></a></h1>
      </div>
      <div class="relnav" role="navigation" aria-label="related navigation">
        <a href="index.html">&laquo; Welcome to cromosim’s documentation!</a> |
        <a href="#">Build a domain</a>
        | <a href="example_ftl.html">Understand one-dimensional microscopic models : the Follow-the-Leader model &raquo;</a>
      </div>
      <div id="contentwrapper">
        <div id="toc" role="navigation" aria-label="table of contents navigation">
          <h3>Table of Contents</h3>
          <ul>
<li><a class="reference internal" href="#">Build a domain</a><ul>
<li><a class="reference internal" href="#manually">Manually</a></li>
<li><a class="reference internal" href="#automatically">Automatically</a></li>
</ul>
</li>
</ul>

        </div>
        <div role="main">
        
  <div class="section" id="build-a-domain">
<h1>Build a domain<a class="headerlink" href="#build-a-domain" title="Permalink to this headline">¶</a></h1>
<p>A domain object contains:</p>
<ul class="simple">
<li><p>a geometry defined by a background image (completely white by
default) and Matplotlib shapes that can be added (lines, circles, ellipses, rectangles or polygons). These elements are walls if they are black. To represent a door serving as an exit to the individuals that will be injected into the domain, a red line will be used.</p></li>
<li><p>a 2D array of the size of the image representing the distance to the nearest wall (black color). This means that each pixel in the image has its distance to the nearest wall.</p></li>
<li><p>a 2D array of the size of the image representing the distance to the nearest exit (red color). The opposite of the gradient of this distance represents the desired direction for an individual desiring to reach this outcome. This desired direction is also stored in an array.</p></li>
</ul>
<p>Reference : <a class="reference internal" href="index.html#mf2018" id="id1"><span>[MF2018]</span></a> Chapter 8.</p>
<div class="section" id="manually">
<h2>Manually<a class="headerlink" href="#manually" title="Permalink to this headline">¶</a></h2>
<p>An example can be found in the directory</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">cromosim</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">domain</span><span class="o">/</span>
</pre></div>
</div>
<p>and can be launched with</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">domain_manually_computed</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Manually means that, from a completely white background image, the
domain will be defined and drawn using Matplotlib shapes (Line2D,…). Hence, the
first lines of the script build the boundary of the room (wall in black color) and
the doors (in red color):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors:</span>
<span class="c1">#     Sylvain Faure &lt;sylvain.faure@math.u-psud.fr&gt;</span>
<span class="c1">#     Bertrand Maury &lt;bertrand.maury@math.u-psud.fr&gt;</span>
<span class="c1">#</span>
<span class="c1">#      cromosim/examples/domain/domain_manually_computed.py</span>
<span class="c1">#      python domain_manually_computed.py</span>
<span class="c1">#</span>
<span class="c1"># License: GPL</span>

<span class="kn">from</span> <span class="nn">cromosim</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Arrow</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>

<span class="c1">## Domain without a background image</span>
<span class="n">pixel_size</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">dom</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;room_400x300&#39;</span><span class="p">,</span> <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">pixel_size</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dom</span><span class="p">)</span>

<span class="c1">##  (x0,y1)------------------------------(x3,y1)</span>
<span class="c1">##    I                                     I</span>
<span class="c1">##    I                                     I</span>
<span class="c1">##  (x0,y0)-----(x1,y0)-door-(x2,y0)-----(x3,y0)</span>
<span class="c1">##</span>
<span class="c1">##                     (xd,yd)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">x1</span> <span class="o">=</span> <span class="mf">19.0</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mf">21.0</span>
<span class="n">x3</span> <span class="o">=</span> <span class="mf">35.0</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">y1</span> <span class="o">=</span> <span class="mf">25.0</span>
<span class="n">xd</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">yd</span> <span class="o">=</span> <span class="mf">2.5</span>

<span class="c1">## Line2D(xdata, ydata, linewidth)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span> <span class="p">[</span><span class="n">x2</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">],[</span><span class="n">y0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">y0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c1">## Line2D(xdata, ydata, linewidth)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">],[</span><span class="n">y0</span><span class="p">,</span><span class="n">y0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_door</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

</pre></div>
</div>
<p>which gives the following domain:</p>
<img src="_static/room_400x300_domain.png" alt="A domain manually defined using lines" style="margin:0px auto;display:block" width="50%" height="auto"/>
<br><p>Then, the desired velocity and the wall distance can also be computed manually
and added to the domain object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dom</span><span class="o">.</span><span class="n">build_domain</span><span class="p">()</span>

<span class="c1">## Compute manually a mask</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">&lt;</span><span class="n">x0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">&gt;</span><span class="n">x3</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="o">&lt;</span><span class="n">y0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="o">&gt;</span><span class="n">y1</span><span class="p">)</span>

<span class="c1">## Compute manually a desired velocity</span>
<span class="n">desired_velocity_X</span> <span class="o">=</span> <span class="n">xd</span> <span class="o">-</span> <span class="n">dom</span><span class="o">.</span><span class="n">X</span>
<span class="n">desired_velocity_Y</span> <span class="o">=</span> <span class="n">yd</span> <span class="o">-</span> <span class="n">dom</span><span class="o">.</span><span class="n">Y</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">desired_velocity_X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">desired_velocity_Y</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">desired_velocity_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">desired_velocity_X</span><span class="o">/</span><span class="n">norm</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="n">desired_velocity_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">desired_velocity_Y</span><span class="o">/</span><span class="n">norm</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">door_distance</span> <span class="o">=</span> <span class="n">norm</span>
<span class="n">dom</span><span class="o">.</span><span class="n">desired_velocity_X</span> <span class="o">=</span> <span class="n">desired_velocity_X</span>
<span class="n">dom</span><span class="o">.</span><span class="n">desired_velocity_Y</span> <span class="o">=</span> <span class="n">desired_velocity_Y</span>

<span class="c1">## Compute manually the wall distance</span>
<span class="c1">##  I-------------wall2----------------I</span>
<span class="c1">## wall3                             wall1</span>
<span class="c1">##  I---wall0---pL--door--pR---wall0---I</span>
<span class="n">dist_wall2</span> <span class="o">=</span> <span class="n">y1</span><span class="o">-</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span>
<span class="n">dist_wall1</span> <span class="o">=</span> <span class="n">x3</span><span class="o">-</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span>
<span class="n">dist_wall3</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">x0</span>
<span class="n">dist_wall0</span> <span class="o">=</span> <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">&lt;=</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span> <span class="o">+</span> \
             <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">&gt;=</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span> <span class="o">+</span> \
             <span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">&gt;</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">&lt;</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  \
             <span class="p">)</span>
<span class="n">wall_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span> \
                    <span class="n">dist_wall0</span><span class="p">,</span><span class="n">dist_wall1</span><span class="p">),</span><span class="n">dist_wall2</span><span class="p">),</span><span class="n">dist_wall3</span><span class="p">),</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span> \
                <span class="p">)</span>
<span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">wall_distance</span><span class="p">,</span><span class="n">edge_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">grad_X</span> <span class="o">=</span> <span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">pixel_size</span>
<span class="n">grad_Y</span> <span class="o">=</span> <span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">pixel_size</span>
<span class="nb">print</span><span class="p">((</span><span class="n">grad_X</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),(</span><span class="n">grad_Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">((</span><span class="n">grad_X</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),(</span><span class="n">grad_Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">grad_X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">grad_Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">wall_grad_X</span> <span class="o">=</span> <span class="n">grad_X</span><span class="o">/</span><span class="n">norm</span>
<span class="n">wall_grad_Y</span> <span class="o">=</span> <span class="n">grad_Y</span><span class="o">/</span><span class="n">norm</span>
<span class="n">dom</span><span class="o">.</span><span class="n">wall_distance</span> <span class="o">=</span> <span class="n">wall_distance</span>
<span class="n">dom</span><span class="o">.</span><span class="n">wall_grad_X</span> <span class="o">=</span> <span class="n">wall_grad_X</span>
<span class="n">dom</span><span class="o">.</span><span class="n">wall_grad_Y</span> <span class="o">=</span> <span class="n">wall_grad_Y</span>


<span class="n">dom</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">dom</span><span class="o">.</span><span class="n">plot_wall_dist</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">plot_desired_velocity</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">## Custom plot function</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">image</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
           <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">dom</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span><span class="n">dom</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span><span class="n">dom</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span><span class="n">dom</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span>
           <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">dom</span><span class="o">.</span><span class="n">wall_distance</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1">#ax1.imshow(wall_distance,interpolation=&#39;nearest&#39;,</span>
<span class="c1">#           extent=[dom.xmin,dom.xmax,dom.ymin,dom.ymax],</span>
<span class="c1">#           alpha=0.7, origin=&#39;lower&#39;)</span>
<span class="c1">#step = 10</span>
<span class="c1">#ax1.quiver(dom.X[::step, ::step],</span>
<span class="c1">#           dom.Y[::step, ::step],</span>
<span class="c1">#           wall_grad_X[::step, ::step],</span>
<span class="c1">#           wall_grad_Y[::step, ::step])</span>
<span class="c1">#ax1.quiver(dom.X[::step, ::step],</span>
<span class="c1">#           dom.Y[::step, ::step],</span>
<span class="c1">#           desired_velocity_X[::step, ::step],</span>
<span class="c1">#           desired_velocity_Y[::step, ::step])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="_static/domain_manually_wall_distance.png" alt="Domain : wall distance" style="margin:0px auto;display:block" width="60%" height="auto"/>
<div align=center>
  <i>Wall distance</i>
</div>
<br>
<img src="_static/domain_manually_desired_velocity.png" alt="Domain : desired velocity" style="margin:0px auto;display:block" width="60%" height="auto"/>
<div align=center>
  <i>Desired velocity (to reach the door)</i>
</div></div>
<div class="section" id="automatically">
<h2>Automatically<a class="headerlink" href="#automatically" title="Permalink to this headline">¶</a></h2>
<p>Starting from a background image drawn using three colors (red for the
doors, black for the walls and white):</p>
<img src="_static/room_400x300.png" alt="A domain manually defined using lines" style="margin:0px auto;display:block" width="50%" height="auto"/>
<br><p>It is still possible to add Matplotlib shapes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors:</span>
<span class="c1">#     Sylvain Faure &lt;sylvain.faure@math.u-psud.fr&gt;</span>
<span class="c1">#     Bertrand Maury &lt;bertrand.maury@math.u-psud.fr&gt;</span>
<span class="c1">#</span>
<span class="c1">#     cromosim/examples/domain/domain_auto_computed.py</span>
<span class="c1">#     python domain_auto_computed.py</span>
<span class="c1">#</span>
<span class="c1"># License: GPL</span>

<span class="kn">from</span> <span class="nn">cromosim</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Arrow</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>

<span class="c1">## Domain from a background image</span>
<span class="n">dom</span> <span class="o">=</span> <span class="n">Domain</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;room_400x300&#39;</span><span class="p">,</span> <span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;room_400x300.png&#39;</span><span class="p">,</span> <span class="n">pixel_size</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="c1">## Circle( (x_center,y_center), radius )</span>
<span class="n">circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mf">20.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>

<span class="c1">## Ellipse( (x_center,y_center), width, height, angle_in_degrees_anti-clockwise )</span>
<span class="n">ell</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span> <span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">),</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">ell</span><span class="p">)</span>

<span class="c1">## Rectangle( (x_lower_left,y_lower_left), width, height, angle_in_degrees_anti-clockwise)</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

<span class="c1">## Polygon( xy )</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([[</span><span class="mf">30.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span>  <span class="p">[</span><span class="mf">32.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span>  <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]])</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

<span class="c1">## Line2D(xdata, ydata, linewidth)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span> <span class="p">[</span><span class="mf">6.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">],[</span><span class="mf">15.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_wall</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c1">## Line2D(xdata, ydata, linewidth)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span> <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">29.0</span><span class="p">],[</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">10.0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">add_door</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">build_domain</span><span class="p">()</span>
<span class="n">dom</span><span class="o">.</span><span class="n">compute_wall_distance</span><span class="p">()</span>
</pre></div>
</div>
<p>and then compute automatically the desired velocity and the wall distance thanks to a fast-marching method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dom</span><span class="o">.</span><span class="n">compute_desired_velocity</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dom</span><span class="p">)</span>

<span class="c1">## Plot functions include in vap.py</span>
<span class="n">dom</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">dom</span><span class="o">.</span><span class="n">plot_wall_dist</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dom</span><span class="o">.</span><span class="n">plot_desired_velocity</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">## Custom plot function</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">image</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
           <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">dom</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span><span class="n">dom</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span><span class="n">dom</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span><span class="n">dom</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span>
           <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">dom</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">dom</span><span class="o">.</span><span class="n">wall_distance</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="c1">#ax1.imshow(dom.wall_distance,interpolation=&#39;nearest&#39;,</span>
<span class="c1">#           extent=[dom.xmin,dom.xmax,dom.ymin,dom.ymax],</span>
<span class="c1">#           alpha=0.7, origin=&#39;lower&#39;)</span>
<span class="c1">#step = 10</span>
<span class="c1">#ax1.quiver(dom.X[::step, ::step],dom.Y[::step, ::step],</span>
<span class="c1">#           dom.wall_grad_X[::step, ::step],</span>
<span class="c1">#           dom.wall_grad_Y[::step, ::step])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="_static/domain_with_shapes.png" alt="Domain with shapes" style="margin:0px auto;display:block" width="60%" height="auto"/>
<div align=center>
 <i>Shapes have been add to the background image</i>
</div>
<br>
<img src="_static/domain_wall_distance.png" alt="Domain : wall distance" style="margin:0px auto;display:block" width="60%" height="auto"/>
<div align=center>
 <i>Wall distance</i>
</div>
<br>
<img src="_static/domain_desired_velocity.png" alt="Domain : desired velocity" style="margin:0px auto;display:block" width="60%" height="auto"/>
<div align=center>
 <i>Desired velocity (to reach the door)</i>
</div></div>
</div>


        </div>
      </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Sylvain Faure, Bertrand Maury.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>