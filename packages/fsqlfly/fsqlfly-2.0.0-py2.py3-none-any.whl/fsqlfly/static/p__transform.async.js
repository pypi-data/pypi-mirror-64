(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{YqIF:function(e,t){ace.define("ace/theme/github",["require","exports","module","ace/lib/dom"],function(e,t,a){t.isDark=!1,t.cssClass="ace-github",t.cssText='.ace-github .ace_gutter {background: #e8e8e8;color: #AAA;}.ace-github  {background: #fff;color: #000;}.ace-github .ace_keyword {font-weight: bold;}.ace-github .ace_string {color: #D14;}.ace-github .ace_variable.ace_class {color: teal;}.ace-github .ace_constant.ace_numeric {color: #099;}.ace-github .ace_constant.ace_buildin {color: #0086B3;}.ace-github .ace_support.ace_function {color: #0086B3;}.ace-github .ace_comment {color: #998;font-style: italic;}.ace-github .ace_variable.ace_language  {color: #0086B3;}.ace-github .ace_paren {font-weight: bold;}.ace-github .ace_boolean {font-weight: bold;}.ace-github .ace_string.ace_regexp {color: #009926;font-weight: normal;}.ace-github .ace_variable.ace_instance {color: teal;}.ace-github .ace_constant.ace_language {font-weight: bold;}.ace-github .ace_cursor {color: black;}.ace-github.ace_focus .ace_marker-layer .ace_active-line {background: rgb(255, 255, 204);}.ace-github .ace_marker-layer .ace_active-line {background: rgb(245, 245, 245);}.ace-github .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-github.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-github.ace_nobold .ace_line > span {font-weight: normal !important;}.ace-github .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-github .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-github .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-github .ace_gutter-active-line {background-color : rgba(0, 0, 0, 0.07);}.ace-github .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-github .ace_invisible {color: #BFBFBF}.ace-github .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-github .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}',e("../lib/dom").importCssString(t.cssText,t.cssClass)})},oQQD:function(e,t,a){"use strict";a.r(t);a("BoS7");var n=a("Sdc0"),r=(a("jCWc"),a("kPKH")),i=(a("14J3"),a("BMrR")),c=(a("Mwp2"),a("VXEj")),l=(a("IzEo"),a("bx4M")),s=(a("MXD1"),a("CFYs")),o=(a("lUTK"),a("BvKs")),u=(a("qVdP"),a("jsC+")),m=(a("+L6B"),a("2/Rp")),d=(a("7Kak"),a("9yH6")),h=(a("2qtc"),a("kLXV")),g=(a("Telt"),a("Tckk")),b=(a("+BJd"),a("mr32")),p=(a("5Dmo"),a("3S7+")),f=a("p0pE"),E=a.n(f),v=a("2Taf"),y=a.n(v),k=a("vZ4D"),C=a.n(k),S=a("l4Ni"),_=a.n(S),w=a("ujKo"),A=a.n(w),x=a("MhPg"),I=a.n(x),N=(a("OaEy"),a("2fM7")),O=(a("5NDa"),a("5rEg")),D=a("q1tI"),B=a.n(D),V=a("wd/R"),L=a.n(V),M=a("MuoO"),j=a("8Skl"),q=a("xvlK"),R=a("WsrF"),T=(a("XlDN"),a("rLCj")),Y=a("P5Jw"),F=a("4NGg"),P=a.n(F),K=a("i8i4"),J=a("WnL9"),H=a("xM2q"),W=a("lc5D"),z=a.n(W),Q=(a("KWgm"),a("bHNl"),a("YqIF"),a("whJP")),U=a("c+yx");function X(e){return function(){var t,a=A()(e);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var n=A()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return _()(this,t)}}var G=O.a.Search,Z=N.a.Option,$="transform",ee=function(e){I()(a,e);var t=X(a);function a(){var e;return y()(this,a),(e=t.apply(this,arguments)).state={visible:!1,done:!1,current:void 0,search:"",msg:"",success:!1,submitted:!1,searchResult:[],tag:0,editVisible:!1,edithDone:!1,edithSubmit:!1},e.formLayout={labelCol:{span:5},wrapperCol:{span:17}},e.normFile=function(e){return Array.isArray(e)?e:e&&e.fileList},e.doRefresh=function(){(0,e.props.dispatch)({type:"".concat($,"/fetch")})},e.showModal=function(){e.setState({editVisible:!0,current:void 0})},e.showRunModal=function(t,a){e.setState({visible:!0,done:!1,msg:""}),(0,e.props.dispatch)({type:"transform/run",payload:E()({},t,{method:a,model:"transform"}),callback:function(t){e.setState({msg:t.msg,done:!0,success:t.success})}})},e.showDebugResult=function(){e.setState({edithSubmit:!0});var t=e.props,a=t.form,n=t.dispatch,r=e.state.current;a.validateFields(function(t,a){t?e.setState({edithSubmit:!1}):(e.setState({submitted:!0}),n({type:"transform/run",payload:E()({},a,r,{method:"debug",id:0,model:"transform"}),callback:function(t){e.setState({edithSubmit:!1}),t.success?window.open(t.data.url):e.setState({msg:t.msg,success:!1,done:!0,visible:!0})}}))})},e.showEditModal=function(t){e.setState({editVisible:!0,current:t})},e.handleDone=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({done:!1,visible:!1})},e.handleCancel=function(){setTimeout(function(){return e.addBtn&&e.addBtn.blur()},0),e.setState({editVisible:!1})},e.handleSubmit=function(){var t=e.props,a=t.form,n=t.dispatch,r=e.state.current;e.setState({visible:!0,done:!1,msg:"..."}),a.validateFields(function(t,a){t||(e.setState({submitted:!0}),n({type:"transform/submit",payload:E()({},r,a),callback:function(t){t.success?e.setState({edithDone:!1,editVisible:!1,success:t.success,msg:t.msg,visible:!1,edithSubmit:!1}):e.setState({done:!0,visible:!0,success:t.success,msg:t.msg,edithSubmit:!1})}}))})},e.handleChange=function(t){var a=e.state.current,n=t.join(","),r=void 0===a?{require:n}:E()({},a,{require:n});e.setState({current:r})},e.deleteItem=function(t){(0,e.props.dispatch)({type:"transform/submit",payload:{id:t}})},e.getNamespace=function(t){if(void 0===t)return null;var a=e.props.namespaces.filter(function(e){return e.id===t});return 0===a.length?null:a[0]},e.getNamespaceTitle=function(t){var a=e.getNamespace(t);return null===a?"":a.name},e.getNameTag=function(t){var a=e.getNamespaceTitle(t);return B.a.createElement(p.a,{title:a},B.a.createElement("div",null,B.a.createElement(b.a,null,Object(U.b)(a))))},e.getNamespaceAvatar=function(t){var a=e.getNamespace(t.namespaceId);return null===a?B.a.createElement(g.a,{alt:t.info,shape:"square",size:"large"},t.name.substr(0,2)):B.a.createElement(g.a,{src:null===a?"":a.avatar,alt:t.info,shape:"square",size:"large"})},e}return C()(a,[{key:"componentDidMount",value:function(){this.doRefresh()}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,g=t.namespaces,b=this.state,f=b.search,v=b.current,y=b.edithSubmit,k=this.props.listBasicList,C=d.a.Group,S=d.a.Button,_=B.a.createElement("div",{className:P.a.extraContent},B.a.createElement(m.a,{onClick:this.doRefresh},B.a.createElement(T.a,null)),B.a.createElement(C,{defaultValue:null,onChange:function(t){return e.setState({tag:t.target.value})}},B.a.createElement(S,{value:0},"全部"),g.length>0&&g.slice(0,8).map(function(e){return B.a.createElement(p.a,{title:e.name,placement:"left"},B.a.createElement(S,{key:e.id,value:e.id},Object(U.b)(e.name,6)))}),g.length>8&&B.a.createElement(u.a,{overlay:B.a.createElement(o.a,{onClick:function(t){var a=t.key;return e.setState({tag:a})}},g.slice(8,g.length+1).map(function(e){return B.a.createElement(o.a.Item,{key:e.id},B.a.createElement(m.a,null," ",e.name))}))},B.a.createElement("a",null,"更多 ",B.a.createElement(j.a,null)))),B.a.createElement(G,{defaultValue:f,className:P.a.extraContentSearch,placeholder:"请输入项目名或者命名空间搜索",onSearch:function(t){return e.setState({search:t})}})),w=function(t){var a=t.data,n=(a.name,a.info,a.isAvailable),r=a.isPublish,i=a.createAt,c=a.updateAt,l=a.namespaceId;return B.a.createElement("div",{className:P.a.listContent},B.a.createElement("div",{className:P.a.listContentItem},e.getNameTag(l)),B.a.createElement("div",{className:P.a.listContentItem},B.a.createElement("span",null,"创建时间"),B.a.createElement("p",null,L()(i).format("YYYY-MM-DD HH:mm"))),B.a.createElement("div",{className:P.a.listContentItem},B.a.createElement("span",null,"修改时间"),B.a.createElement("p",null,L()(c).format("YYYY-MM-DD HH:mm"))),B.a.createElement("div",{className:P.a.listContentItem},B.a.createElement(s.a,{type:"circle",percent:100,status:n?r?"success":"normal":"exception",strokeWidth:1,width:50,style:{width:180}})))},A=function(t){var a=t.item;return B.a.createElement(u.a,{overlay:B.a.createElement(o.a,{onClick:function(t){return function(t,a){"start"===t||"stop"===t||"restart"===t?e.showRunModal(a,t):"delete"===t&&h.a.confirm({title:"删除任务",content:"确定删除该任务吗？",okText:"确认",cancelText:"取消",onOk:function(){return e.deleteItem(void 0!==a.id?a.id:0)}})}(t.key,a)}},B.a.createElement(o.a.Item,{key:"delete"},"删除"),B.a.createElement(o.a.Item,{key:"start"},"运行"),B.a.createElement(o.a.Item,{key:"stop"},"停止"),B.a.createElement(o.a.Item,{key:"restart"},"重启"),B.a.createElement(o.a.Item,{key:"copy"},B.a.createElement(Y.CopyToClipboard,{text:a.require,onCopy:function(){return e.setState({edithDone:!0})}},B.a.createElement("span",null,"复制依赖"))))},B.a.createElement("a",null,"更多 ",B.a.createElement(j.a,null)))},x=R.a.Item,I=N.a.Option,D={okText:"保存",onOk:this.handleSubmit,onCancel:this.handleCancel,footer:[B.a.createElement(m.a,{key:"back",onClick:this.handleCancel},"取消"),B.a.createElement(m.a,{key:"submit",type:"primary",loading:y,onClick:this.handleSubmit},"保存"),B.a.createElement(m.a,{type:"primary",onClick:function(t){return e.showDebugResult()},loading:y},"调试")]},V=this.props,M=V.form.getFieldDecorator,F=V.resources,W=function(e){return void 0!==e.namespaceId&&null!==e.namespaceId?(t=e.namespaceId,a=e.name,0===(n=g.filter(function(e){return e.id===t})).length?a:n[0].name+"."+a):e.name;var t,a,n},X=Array.isArray(F)?F.map(function(e){return B.a.createElement(Z,{key:e.id,title:e.info,value:W(e)},W(e))}):[];return B.a.createElement(B.a.Fragment,null,B.a.createElement("div",{className:P.a.standardList},B.a.createElement(l.a,{className:P.a.listCard,bordered:!1,title:"资源",style:{marginTop:24},bodyStyle:{padding:"0 32px 40px 32px"},extra:_},B.a.createElement(m.a,{type:"dashed",style:{width:"100%",marginBottom:8},icon:B.a.createElement(q.a,null),onClick:this.showModal,ref:function(t){e.addBtn=Object(K.findDOMNode)(t)}},"添加"),B.a.createElement(c.a,{size:"large",rowKey:"id",loading:a,dataSource:k.filter(function(t){return t.name.indexOf(f)>=0&&(0===e.state.tag||t.namespaceId===e.state.tag)}),renderItem:function(t){return B.a.createElement(c.a.Item,{actions:[B.a.createElement("a",{key:"edit",onClick:function(a){a.preventDefault(),e.showEditModal(t)}},"编辑"),B.a.createElement(A,{key:"more",item:t})]},B.a.createElement(c.a.Item.Meta,{avatar:e.getNamespaceAvatar(t),title:B.a.createElement(p.a,{title:t.name},B.a.createElement("a",{href:"#"},Object(U.b)(t.name))),description:B.a.createElement(p.a,{title:t.info,placement:"right"},B.a.createElement("span",null,Object(U.b)(t.info)))}),B.a.createElement(w,{data:t}))}}))),B.a.createElement(h.a,{title:"运行结果",className:P.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.visible,onCancel:function(t){return e.setState({visible:!1})},footer:null,confirmLoading:this.state.done},B.a.createElement(J.a,{type:this.state.done?this.state.success?"success":"error":"line",title:this.state.done?this.state.success?"运行成功":"运行失败":"提交中...",description:this.state.msg,actions:B.a.createElement(m.a,{loading:!this.state.done,type:"primary",onClick:function(t){return e.setState({visible:!1})}},"知道了"),className:P.a.formResult})),B.a.createElement(h.a,Object.assign({title:void 0===v?null:void 0===v.id?"新增":"编辑",className:P.a.standardListForm,width:1080,bodyStyle:{padding:"72px 0"},destroyOnClose:!0,visible:this.state.editVisible},D),B.a.createElement(R.a,{onSubmit:this.handleSubmit},B.a.createElement(x,Object.assign({label:"名称"},this.formLayout),M("name",{rules:H.a,initialValue:void 0===v?"":v.name})(B.a.createElement(O.a,{placeholder:"请输入"}))),B.a.createElement(x,Object.assign({label:"介绍"},this.formLayout),M("info",{initialValue:void 0===v?"":v.info})(B.a.createElement(Q.a,{placeholder:"请输入"}))),B.a.createElement(x,Object.assign({label:"依赖"},this.formLayout),B.a.createElement(N.a,{mode:"tags",onChange:this.handleChange,tokenSeparators:[","],defaultValue:void 0===v||void 0===v.require?void 0:v.require.split(",")},X)),B.a.createElement(x,Object.assign({label:"命名空间"},this.formLayout),M("namespaceId",{initialValue:void 0===v||null===v.namespaceId?0:v.namespaceId,rules:[{required:!1}]})(B.a.createElement(N.a,null,B.a.createElement(I,{key:-1,value:0},"默认"),g.length>0&&g.map(function(e){return B.a.createElement(I,{key:e.id,value:e.id},e.name)})))),B.a.createElement(x,Object.assign({label:"SQL"},this.formLayout),B.a.createElement(z.a,{mode:"sql",theme:"github",onChange:function(t){return e.setState({current:E()({},v,{sql:t})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:void 0===v?"":v.sql,value:void 0===v?"":v.sql,width:765,height:650})),B.a.createElement(x,Object.assign({label:"配置文件"},this.formLayout),B.a.createElement(z.a,{mode:"yaml",theme:"solarized_dark",onChange:function(t){return e.setState({current:E()({},v,{yaml:t})})},name:"functionConstructorConfig",editorProps:{$blockScrolling:!0},readOnly:!1,placeholder:"请输入Yaml配置",defaultValue:void 0===v?"":v.yaml,value:void 0===v?"":v.yaml,width:765,height:650})),B.a.createElement(x,Object.assign({label:"其他"},this.formLayout),B.a.createElement(i.a,{gutter:16},B.a.createElement(r.a,{span:3},M("isAvailable",{initialValue:void 0!==v&&v.isAvailable,valuePropName:"checked"})(B.a.createElement(n.a,{checkedChildren:"启用",unCheckedChildren:"禁止"}))),B.a.createElement(r.a,{span:3},M("isPublish",{initialValue:void 0!==v&&v.isPublish,valuePropName:"checked"})(B.a.createElement(n.a,{checkedChildren:"发布",unCheckedChildren:"开发"}))))))))}}]),a}(D.Component),te=R.a.create()(ee);t.default=Object(M.connect)(function(e){var t=e.transform,a=e.loading;return{listBasicList:t.list,namespaces:t.dependence,loading:a.models.namespace,resources:t.dependence1}})(te)}}]);