(this["webpackJsonprasa-interface"]=this["webpackJsonprasa-interface"]||[]).push([[5],{1603:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(266),l=r(17),c=r(33),s=r(62),i=r(69),u=r(6),m=r(104),f=r(43),d=r(1),E=r(12),h=r(29),p=r(80),b=r(10),v=r(147),y=r(14),g=r(34);function O(e){var t=e.roles,r=e.roleUsers,a=e.total,o=e.onLoadMoreRows,l=e.onEdit,c=e.onDelete,s=n.useCallback((function(e){var t=e.dataSelected,a=e.setSelected,o=t.filter((function(e){return(r[e.role]||[]).length>0})).length;return n.createElement(d.Box,null,n.createElement(h.a,{resource:E.c.Roles,action:E.a.Delete,yes:n.createElement(g.a,{content:o>0?"Cannot perform delete because ".concat(1===o?"the selected role still has":"".concat(o," selected roles still have")," users assigned"):"Delete"},n.createElement(u.a,{variant:"inverse",disabled:o>0,onClick:function(){c(t),a([])}},"Delete"))}))}),[c,r]),i=n.useCallback((function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var a=e.rowIndex,o=e.rowData,l=t.includes(a);return n.createElement(d.Flex,null,n.createElement(d.Box,{flex:"0 1 auto"},n.createElement("label",null,n.createElement(p.a,{checked:l,onChange:function(){return r(a,!l)}}))),n.createElement(d.Box,{ml:3,flex:"1"},n.createElement(y.a,{variant:"body.secondary"},o.role)))}}),[]),m=n.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var a=r[t.role]||[];return n.createElement(d.Flex,{flexDirection:"row-reverse",mr:-1},n.createElement(h.a,{resource:E.c.Roles,action:E.a.Delete,yes:0===a.length?n.createElement(g.a,{content:"Delete"},n.createElement(u.a,{mx:1,onClick:function(){c([t])},variant:"icon"},n.createElement(b.a,{icon:"trash-alt"}))):n.createElement(d.Box,{mx:1,flex:"0 0 40px"})}),n.createElement(h.a,{resource:E.c.Roles,action:E.a.Update,yes:n.createElement(g.a,{content:"Edit"},n.createElement(u.a,{mx:1,onClick:function(){l(t)},variant:"icon"},n.createElement(b.a,{icon:"edit"})))}))}}),[r,l,c]);return n.createElement(v.a,{total:a,bulkActionsRenderer:s,data:t,resource:E.c.Roles,onLoadMoreRows:o},(function(e){return[n.createElement(f.d,{key:"role",cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:i(e)}),n.createElement(f.d,{key:"description",cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return n.createElement(y.a,{variant:"body.secondary"},t.description||"No description")}}),n.createElement(f.d,{key:"users",cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:function(e){var t=e.rowData,a=r[t.role]||[];return 0===a.length?n.createElement(y.a,{variant:"body.secondary"},"No users currently have this role"):a.length<3?n.createElement(y.a,{variant:"body.secondary"},a.map((function(e){return e.username})).join(" and ")):n.createElement(y.a,{variant:"body.secondary"},a.slice(0,2).map((function(e){return e.username})).join(", "),n.createElement("b",null," +",a.length-2," more"))}}),n.createElement(f.d,{key:"role",cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:m()})]}))}function x(e){var t=e.roleUsers,r=e.roles,a=e.total,o=e.onLoadMoreRows,l=e.onNavigate,c=e.onDeleteRole,s=n.useCallback((function(e){return l("/roles/".concat(e.role))}),[l]);return n.useEffect((function(){o({search:"",offset:0,limit:0})}),[o]),n.createElement(m.a,{title:"Roles",rightContent:n.createElement(u.a,{variant:"primary",large:!0,onClick:function(){return l("/roles/create")},mr:4},"Create new role")},n.createElement(O,{roleUsers:t,roles:r,total:a,onLoadMoreRows:o,onEdit:s,onDelete:c}))}var w={onFetchRoles:i.d.request,onDeleteRole:i.a.request};var j=Object(o.i)(Object(c.b)((function(e){return{roles:e.roles.roles,roleUsers:e.roles.roleUsers,userRole:e.auth.role,total:e.roles.total}}),w)((function(e){var t=e.history,r=Object(l.a)(e,["history"]),a=Object(s.c)(i.d);return n.createElement(x,Object.assign({},r,{onNavigate:t.push,onLoadMoreRows:a}))}))),R=r(85),C=r(8),D=r(5),k=r(593),U=r(308),P=r(179),F=r(27);function S(e){return a.a.createElement(u.a,Object.assign({variant:"icon",color:"neutral_8"},e),a.a.createElement(b.a,{icon:["fas","arrow-left"]}))}var B,M=r(132),N=r(40),q=r(167),G=r(22);function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e,t){return[].concat(Object(G.a)(e?["read:any"]:[]),Object(G.a)(t?["create:any","update:any","delete:any"]:[]))}function _(e){var t=e.value,r=e.permission,a=e.onChange,o=t.includes("read:any"),l=t.includes("create:any");return n.createElement(d.Flex,{py:3},n.createElement(d.Box,{flex:4,width:4/6},n.createElement(y.a,null,r.label)),n.createElement(d.Box,{flex:1,width:1/6},!r.cannotView&&n.createElement("label",null,n.createElement(p.a,{checked:o,onChange:function(){return a(L(!o,l))}}))),n.createElement(d.Box,{flex:1,width:1/6},!r.cannotModify&&n.createElement("label",null,n.createElement(p.a,{checked:l,onChange:function(){return a(L(o,!l))}}))))}function K(e){var t=e.value,r=e.onChange,a=e.permissions;return n.createElement(d.Box,null,n.createElement(d.Flex,{py:3},n.createElement(d.Box,{flex:4,width:4/6},n.createElement(F.a,{variant:3},"Permissions")),n.createElement(d.Box,{flex:1,width:1/6},n.createElement(F.a,{variant:3},"View")),n.createElement(d.Box,{flex:1,width:1/6},n.createElement(F.a,{variant:3},"Modify"))),a.map((function(e){return n.createElement(_,{key:e.resource,permission:e,value:t[e.resource]||[],onChange:function(n){return r(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(r,!0).forEach((function(t){Object(C.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,Object(C.a)({},e.resource,n)))}})})))}function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(B||(B={}));var I={role:"",description:"",is_default:!1,grants:{}};function J(e){var t=e.users,r=e.role,a=e.roleUsers,o=void 0===a?[]:a,l=e.onNavigate,c=e.onSaveRole,s=e.onUpdateRole,i=e.onFetchUsers,f=e.permissions;n.useEffect((function(){i({search:"",limit:0,offset:0})}),[i]);var E=n.useState(r||I),h=Object(D.a)(E,2),b=h[0],v=h[1];n.useEffect((function(){r&&v(r)}),[r]);var g=n.useCallback((function(e){return v(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(r,!0).forEach((function(t){Object(C.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},b,{},e))}),[b]),O=n.useState([]),x=Object(D.a)(O,2),w=x[0],j=x[1];n.useEffect((function(){o&&j(o.map((function(e){return{label:e.username,value:e.username,data:e}})))}),[o,o.length]);var R=n.useState(B.Users),G=Object(D.a)(R,2),A=G[0],L=G[1],_=n.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return n.createElement(m.a,{scrollable:!0,title:n.createElement(n.Fragment,null,n.createElement(S,{onClick:function(){return l("/roles")}})," ",r?"Edit":"Create new"," Role"),rightContent:n.createElement(d.Flex,{mr:-2,pr:4,flexDirection:"row-reverse"},n.createElement(u.a,{variant:"primary",onClick:function(){var e=w.map((function(e){return e.data}));r?s({currentId:r.role,role:b,users:e}):c({role:b,users:e}),l("/roles")},large:!0,mr:2},r?"Save":"Create"," role"),n.createElement(u.a,{variant:"secondary",onClick:function(){return l("/roles")},large:!0,mr:2},r?"Cancel":"Discard"))},n.createElement(d.Box,{width:2/3,m:"0 auto"},n.createElement(P.a,{sx:{borderRadius:"large"},p:6,mb:6},n.createElement(F.a,{variant:2,mb:4},"Basic Details"),n.createElement(d.Box,{mb:4,width:"100%"},n.createElement(q.a,{text:"Name"},n.createElement(N.a,{value:b.role,onChangeValue:function(e){return g({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0}))),n.createElement(d.Box,{mb:4,width:"100%"},n.createElement(q.a,{text:"Description"},n.createElement(N.a,{value:b.description||"",onChangeValue:function(e){return g({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"}))),n.createElement(d.Flex,{as:"label",alignItems:"center"},n.createElement(p.a,{checked:b.is_default||!1,onChange:function(e){return g({is_default:!b.is_default})},mr:2}),n.createElement(y.a,null,"Set as default roles"))),n.createElement(P.a,{sx:{borderRadius:"large"},p:6},n.createElement(k.a,{justifyContent:"flex-start",ml:-3,mb:4},n.createElement(U.a,{variant:2,active:A===B.Permissions,onClick:function(){return L(B.Permissions)}},"Add Permissions"),n.createElement(U.a,{variant:2,active:A===B.Users,onClick:function(){return L(B.Users)}},"Add Users")),A===B.Permissions&&n.createElement(K,{permissions:f,value:b.grants,onChange:function(e){return g({grants:e})}}),A===B.Users&&n.createElement(q.a,{text:"Add users to this Role"},n.createElement(M.a,{isMulti:!0,placeholder:"Search users...",options:_,value:w,onChange:function(e){return Array.isArray(e)&&j(e)},hideSelectedOptions:!1})))))}var W={onSaveRole:i.f.request,onUpdateRole:i.g.request,onFetchUsers:R.c.request,onFetchRole:i.b.request,onFetchRoleUsers:i.c.request};var z=Object(o.i)(Object(c.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles,roleUsers:e.roles.roleUsers}}),W)((function(e){var t=e.history,r=e.roles,a=e.roleUsers,o=e.onFetchRoleUsers,c=e.onFetchRole,s=e.match,i=Object(l.a)(e,["history","roles","roleUsers","onFetchRoleUsers","onFetchRole","match"]),u=s.params.roleName;n.useEffect((function(){u&&(c(u),o(u))}),[c,o,u]);var m=n.useMemo((function(){if(u)return Object.values(r).find((function(e){return e.role===u}))}),[u,r]),f=n.useMemo((function(){return u?a[u]:[]}),[u,a]);return n.createElement(n.Fragment,null,n.createElement(J,Object.assign({onNavigate:t.push,role:m,roleUsers:f},i)))})));t.default=Object(o.i)((function(e){var t=e.match;return n.createElement(o.e,null,n.createElement(o.c,{exact:!0,path:t.path,component:j}),n.createElement(o.c,{exact:!0,path:"".concat(t.path,"/create"),component:z}),n.createElement(o.c,{exact:!0,path:"".concat(t.path,"/:roleName"),component:z}))}))}}]);