{"version":3,"sources":["webpack:///./src/resources/codemirror.ondemand.ts","webpack:///./src/components/ha-code-editor.ts","webpack:///./src/components/ha-yaml-editor.ts"],"names":["loaded","loadCodeMirror","_ref","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","Promise","all","__webpack_require__","e","then","bind","abrupt","stop","apply","this","arguments","_decorate","customElement","_initialize","_UpdatingElement","HaCodeEditor","_UpdatingElement2","_getPrototypeOf2","_this","_classCallCheck","_len","length","args","Array","_key","_getPrototypeOf","call","concat","_assertThisInitialized","_inherits","F","d","kind","key","value","decorators","property","_value","codemirror","getValue","shadowRoot","querySelector","_get","prototype","refresh","autofocus","focus","changedProps","has","setOption","mode","setValue","_calcGutters","_setScrollBarDirection","classList","toggle","error","_load","_load2","codeMirror","_this2","sent","attachShadow","innerHTML","codeMirrorCss","lineNumbers","tabSize","viewportMargin","Infinity","extraKeys","Tab","Shift-Tab","gutters","on","_onChange","newValue","fireEvent","rtl","getWrapperElement","UpdatingElement","_LitElement","_LitElement2","HaYamlEditor","query","_yaml","obj","_typeof","hasOwnProperty","isEmpty","safeDump","err","alert","afterNextRender","_this2$_editor","_editor","defaultValue","undefined","html","_templateObject","label","_templateObject2","isValid","ev","stopPropagation","parsed","detail","safeLoad","LitElement"],"mappings":"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","file":"chunk.00434b3e384283f15b10.js","sourcesContent":["interface LoadedCodeMirror {\n  codeMirror: any;\n  codeMirrorCss: any;\n}\n\nlet loaded: Promise<LoadedCodeMirror>;\n\nexport const loadCodeMirror = async (): Promise<LoadedCodeMirror> => {\n  if (!loaded) {\n    loaded = import(/* webpackChunkName: \"codemirror\" */ \"./codemirror\");\n  }\n  return loaded;\n};\n","import { loadCodeMirror } from \"../resources/codemirror.ondemand\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport {\n  UpdatingElement,\n  property,\n  customElement,\n  PropertyValues,\n} from \"lit-element\";\nimport { Editor } from \"codemirror\";\n\ndeclare global {\n  interface HASSDomEvents {\n    \"editor-save\": undefined;\n  }\n}\n\n@customElement(\"ha-code-editor\")\nexport class HaCodeEditor extends UpdatingElement {\n  public codemirror?: Editor;\n  @property() public mode?: string;\n  @property() public autofocus = false;\n  @property() public rtl = false;\n  @property() public error = false;\n  @property() private _value = \"\";\n\n  public set value(value: string) {\n    this._value = value;\n  }\n\n  public get value(): string {\n    return this.codemirror ? this.codemirror.getValue() : this._value;\n  }\n\n  public get hasComments(): boolean {\n    return this.shadowRoot!.querySelector(\"span.cm-comment\") ? true : false;\n  }\n\n  public connectedCallback() {\n    super.connectedCallback();\n    if (!this.codemirror) {\n      return;\n    }\n    this.codemirror.refresh();\n    if (this.autofocus !== false) {\n      this.codemirror.focus();\n    }\n  }\n\n  protected update(changedProps: PropertyValues): void {\n    super.update(changedProps);\n\n    if (!this.codemirror) {\n      return;\n    }\n\n    if (changedProps.has(\"mode\")) {\n      this.codemirror.setOption(\"mode\", this.mode);\n    }\n    if (changedProps.has(\"autofocus\")) {\n      this.codemirror.setOption(\"autofocus\", this.autofocus !== false);\n    }\n    if (changedProps.has(\"_value\") && this._value !== this.value) {\n      this.codemirror.setValue(this._value);\n    }\n    if (changedProps.has(\"rtl\")) {\n      this.codemirror.setOption(\"gutters\", this._calcGutters());\n      this._setScrollBarDirection();\n    }\n    if (changedProps.has(\"error\")) {\n      this.classList.toggle(\"error-state\", this.error);\n    }\n  }\n\n  protected firstUpdated(changedProps: PropertyValues): void {\n    super.firstUpdated(changedProps);\n    this._load();\n  }\n\n  private async _load(): Promise<void> {\n    const loaded = await loadCodeMirror();\n\n    const codeMirror = loaded.codeMirror;\n\n    const shadowRoot = this.attachShadow({ mode: \"open\" });\n\n    shadowRoot!.innerHTML = `\n    <style>\n      ${loaded.codeMirrorCss}\n      .CodeMirror {\n        height: var(--code-mirror-height, auto);\n        direction: var(--code-mirror-direction, ltr);\n      }\n      .CodeMirror-scroll {\n        max-height: var(--code-mirror-max-height, --code-mirror-height);\n      }\n      .CodeMirror-gutters {\n        border-right: 1px solid var(--paper-input-container-color, var(--secondary-text-color));\n        background-color: var(--paper-dialog-background-color, var(--primary-background-color));\n        transition: 0.2s ease border-right;\n      }\n      :host(.error-state) .CodeMirror-gutters {\n        border-color: var(--error-state-color, red);\n      }\n      .CodeMirror-focused .CodeMirror-gutters {\n        border-right: 2px solid var(--paper-input-container-focus-color, var(--primary-color));\n      }\n      .CodeMirror-linenumber {\n        color: var(--paper-dialog-color, var(--primary-text-color));\n      }\n      .rtl .CodeMirror-vscrollbar {\n        right: auto;\n        left: 0px;\n      }\n      .rtl-gutter {\n        width: 20px;\n      }\n    </style>`;\n\n    this.codemirror = codeMirror(shadowRoot, {\n      value: this._value,\n      lineNumbers: true,\n      tabSize: 2,\n      mode: this.mode,\n      autofocus: this.autofocus !== false,\n      viewportMargin: Infinity,\n      extraKeys: {\n        Tab: \"indentMore\",\n        \"Shift-Tab\": \"indentLess\",\n      },\n      gutters: this._calcGutters(),\n    });\n    this._setScrollBarDirection();\n    this.codemirror!.on(\"changes\", () => this._onChange());\n  }\n\n  private _onChange(): void {\n    const newValue = this.value;\n    if (newValue === this._value) {\n      return;\n    }\n    this._value = newValue;\n    fireEvent(this, \"value-changed\", { value: this._value });\n  }\n\n  private _calcGutters(): string[] {\n    return this.rtl ? [\"rtl-gutter\", \"CodeMirror-linenumbers\"] : [];\n  }\n\n  private _setScrollBarDirection(): void {\n    if (this.codemirror) {\n      this.codemirror.getWrapperElement().classList.toggle(\"rtl\", this.rtl);\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-code-editor\": HaCodeEditor;\n  }\n}\n","import { safeDump, safeLoad } from \"js-yaml\";\nimport \"./ha-code-editor\";\nimport { LitElement, property, customElement, html, query } from \"lit-element\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { afterNextRender } from \"../common/util/render-status\";\n// tslint:disable-next-line\nimport { HaCodeEditor } from \"./ha-code-editor\";\n\ndeclare global {\n  // for fire event\n  interface HASSDomEvents {\n    \"editor-refreshed\": undefined;\n  }\n}\n\nconst isEmpty = (obj: object) => {\n  if (typeof obj !== \"object\") {\n    return false;\n  }\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n@customElement(\"ha-yaml-editor\")\nexport class HaYamlEditor extends LitElement {\n  @property() public value?: any;\n  @property() public defaultValue?: any;\n  @property() public isValid = true;\n  @property() public label?: string;\n  @property() private _yaml: string = \"\";\n  @query(\"ha-code-editor\") private _editor?: HaCodeEditor;\n\n  public setValue(value) {\n    try {\n      this._yaml = value && !isEmpty(value) ? safeDump(value) : \"\";\n    } catch (err) {\n      alert(`There was an error converting to YAML: ${err}`);\n    }\n    afterNextRender(() => {\n      if (this._editor?.codemirror) {\n        this._editor.codemirror.refresh();\n      }\n      afterNextRender(() => fireEvent(this, \"editor-refreshed\"));\n    });\n  }\n\n  protected firstUpdated() {\n    if (this.defaultValue) {\n      this.setValue(this.defaultValue);\n    }\n  }\n\n  protected render() {\n    if (this._yaml === undefined) {\n      return;\n    }\n    return html`\n      ${this.label\n        ? html`\n            <p>${this.label}</p>\n          `\n        : \"\"}\n      <ha-code-editor\n        .value=${this._yaml}\n        mode=\"yaml\"\n        .error=${this.isValid === false}\n        @value-changed=${this._onChange}\n      ></ha-code-editor>\n    `;\n  }\n\n  private _onChange(ev: CustomEvent) {\n    ev.stopPropagation();\n    const value = ev.detail.value;\n    let parsed;\n    let isValid = true;\n\n    if (value) {\n      try {\n        parsed = safeLoad(value);\n      } catch (err) {\n        // Invalid YAML\n        isValid = false;\n      }\n    } else {\n      parsed = {};\n    }\n\n    this.value = parsed;\n    this.isValid = isValid;\n\n    fireEvent(this, \"value-changed\", { value: parsed, isValid } as any);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-yaml-editor\": HaYamlEditor;\n  }\n}\n"],"sourceRoot":""}