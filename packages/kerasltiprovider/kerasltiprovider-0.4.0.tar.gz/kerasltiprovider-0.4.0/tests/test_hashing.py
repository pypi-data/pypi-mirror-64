import uuid

import numpy as np
import pytest
from tensorflow import keras

from kerasltiprovider.utils import hash_matrix, hash_user_id

m1_float = np.array([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0]], np.float32)
m1_0 = np.array([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0]], np.int32)
m1_1 = np.array([[1, 2, 3], [4, 5, 6]], np.int32)
m2 = np.array([[4, 5, 6], [1, 2, 3]], np.int32)
m3 = np.array([[6, 5, 4], [1, 2, 3]], np.int32)

m4 = np.array(
    [
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.00392157,
            0.17254902,
            0.48235294,
            0.56862745,
            0.60784314,
            0.6,
            0.59215686,
            0.61568627,
            0.6,
            0.54117647,
            0.39607843,
            0.06666667,
            0.00392157,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.00784314,
            0.17647059,
            0.51764706,
            0.75686275,
            0.88235294,
            0.91764706,
            0.95294118,
            0.95294118,
            0.94901961,
            0.96078431,
            0.94117647,
            0.89411765,
            0.84705882,
            0.67058824,
            0.38039216,
            0.05882353,
            0.00392157,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.00784314,
            0.34117647,
            0.58823529,
            0.7254902,
            0.81568627,
            0.8745098,
            0.8745098,
            0.88235294,
            0.89019608,
            0.89411765,
            0.88627451,
            0.8745098,
            0.86666667,
            0.8627451,
            0.78431373,
            0.69411765,
            0.55294118,
            0.22745098,
            0.00392157,
            0.0,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.00392157,
            0.23921569,
            0.58431373,
            0.71764706,
            0.79607843,
            0.84705882,
            0.87843137,
            0.86666667,
            0.8745098,
            0.88627451,
            0.88627451,
            0.87843137,
            0.87058824,
            0.86666667,
            0.87058824,
            0.83137255,
            0.78039216,
            0.70980392,
            0.56078431,
            0.16078431,
            0.00392157,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.00784314,
            0.47843137,
            0.71372549,
            0.79215686,
            0.81960784,
            0.84705882,
            0.8745098,
            0.8627451,
            0.8745098,
            0.87843137,
            0.8745098,
            0.87843137,
            0.87058824,
            0.86666667,
            0.87058824,
            0.84705882,
            0.82745098,
            0.79215686,
            0.70588235,
            0.44705882,
            0.02352941,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.15294118,
            0.62352941,
            0.78039216,
            0.80784314,
            0.83137255,
            0.85098039,
            0.87058824,
            0.85882353,
            0.86666667,
            0.87058824,
            0.8745098,
            0.8745098,
            0.86666667,
            0.86666667,
            0.8745098,
            0.85490196,
            0.83921569,
            0.82352941,
            0.77647059,
            0.63137255,
            0.3254902,
            0.01176471,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.34117647,
            0.69411765,
            0.80784314,
            0.82352941,
            0.83921569,
            0.85098039,
            0.8627451,
            0.85882353,
            0.8627451,
            0.87058824,
            0.87843137,
            0.87843137,
            0.87058824,
            0.87058824,
            0.8745098,
            0.8627451,
            0.85098039,
            0.84313725,
            0.81568627,
            0.7372549,
            0.56078431,
            0.23137255,
            0.00392157,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.00392157,
            0.44705882,
            0.7372549,
            0.82745098,
            0.83921569,
            0.84705882,
            0.85098039,
            0.8627451,
            0.85882353,
            0.86666667,
            0.87058824,
            0.8745098,
            0.88627451,
            0.87058824,
            0.87058824,
            0.87058824,
            0.86666667,
            0.86666667,
            0.85882353,
            0.83529412,
            0.78039216,
            0.68235294,
            0.48627451,
            0.02352941,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.04313725,
            0.54901961,
            0.76470588,
            0.83529412,
            0.85882353,
            0.85490196,
            0.85098039,
            0.8627451,
            0.8627451,
            0.8627451,
            0.87058824,
            0.86666667,
            0.89019608,
            0.87843137,
            0.8745098,
            0.8745098,
            0.8745098,
            0.87843137,
            0.8745098,
            0.85490196,
            0.80784314,
            0.7372549,
            0.61960784,
            0.16862745,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.1254902,
            0.59215686,
            0.78431373,
            0.84313725,
            0.87058824,
            0.86666667,
            0.85490196,
            0.86666667,
            0.8627451,
            0.87058824,
            0.8745098,
            0.86666667,
            0.89411765,
            0.88627451,
            0.88235294,
            0.87843137,
            0.87843137,
            0.88627451,
            0.88235294,
            0.86666667,
            0.81960784,
            0.76470588,
            0.69411765,
            0.30588235,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.15686275,
            0.60784314,
            0.79607843,
            0.84313725,
            0.87843137,
            0.8745098,
            0.85882353,
            0.87058824,
            0.86666667,
            0.87843137,
            0.87843137,
            0.87058824,
            0.89803922,
            0.88627451,
            0.88627451,
            0.88627451,
            0.88235294,
            0.89019608,
            0.88627451,
            0.87058824,
            0.83137255,
            0.78431373,
            0.74509804,
            0.45882353,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.1254902,
            0.58431373,
            0.79607843,
            0.83529412,
            0.8745098,
            0.8745098,
            0.8627451,
            0.8745098,
            0.87058824,
            0.88627451,
            0.87843137,
            0.87058824,
            0.89803922,
            0.88627451,
            0.89019608,
            0.89019608,
            0.89019608,
            0.89411765,
            0.89019608,
            0.87058824,
            0.83529412,
            0.79607843,
            0.78039216,
            0.58823529,
            0.00392157,
        ],
        [
            0.0,
            0.0,
            0.00392157,
            0.14509804,
            0.61568627,
            0.8,
            0.83921569,
            0.8745098,
            0.87058824,
            0.86666667,
            0.88235294,
            0.87843137,
            0.89019608,
            0.88235294,
            0.87843137,
            0.89803922,
            0.89019608,
            0.89019608,
            0.89411765,
            0.89019608,
            0.90196078,
            0.89803922,
            0.87843137,
            0.85490196,
            0.80784314,
            0.79607843,
            0.69019608,
            0.04313725,
        ],
        [
            0.0,
            0.0,
            0.00784314,
            0.21568627,
            0.63529412,
            0.81176471,
            0.84313725,
            0.87843137,
            0.87058824,
            0.8745098,
            0.88235294,
            0.87843137,
            0.89019608,
            0.88235294,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89019608,
            0.89803922,
            0.89019608,
            0.89803922,
            0.89803922,
            0.88235294,
            0.85882353,
            0.81176471,
            0.79607843,
            0.74117647,
            0.10196078,
        ],
        [
            0.0,
            0.00784314,
            0.09411765,
            0.38431373,
            0.68627451,
            0.82352941,
            0.85490196,
            0.87843137,
            0.8627451,
            0.87843137,
            0.88627451,
            0.88235294,
            0.89411765,
            0.88627451,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89019608,
            0.89411765,
            0.88627451,
            0.89019608,
            0.89411765,
            0.87843137,
            0.85882353,
            0.81568627,
            0.8,
            0.77254902,
            0.15294118,
        ],
        [
            0.00392157,
            0.17254902,
            0.36470588,
            0.54117647,
            0.72941176,
            0.83137255,
            0.85490196,
            0.8745098,
            0.8627451,
            0.88235294,
            0.89019608,
            0.88627451,
            0.89411765,
            0.88627451,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89019608,
            0.89803922,
            0.88627451,
            0.89411765,
            0.89803922,
            0.88235294,
            0.8627451,
            0.81960784,
            0.8,
            0.80392157,
            0.2,
        ],
        [
            0.03529412,
            0.34901961,
            0.4745098,
            0.6,
            0.74901961,
            0.83921569,
            0.8627451,
            0.87058824,
            0.8627451,
            0.89019608,
            0.89019608,
            0.88627451,
            0.89411765,
            0.88627451,
            0.88627451,
            0.90196078,
            0.89803922,
            0.89411765,
            0.90196078,
            0.89019608,
            0.88627451,
            0.89803922,
            0.89019608,
            0.86666667,
            0.81568627,
            0.79607843,
            0.80784314,
            0.21568627,
        ],
        [
            0.07843137,
            0.42745098,
            0.54901961,
            0.64313725,
            0.77647059,
            0.84705882,
            0.87058824,
            0.87058824,
            0.87058824,
            0.89411765,
            0.89019608,
            0.89019608,
            0.89803922,
            0.89019608,
            0.88235294,
            0.89803922,
            0.89803922,
            0.89019608,
            0.89803922,
            0.88627451,
            0.87843137,
            0.89019608,
            0.88627451,
            0.85490196,
            0.81176471,
            0.78431373,
            0.78039216,
            0.2,
        ],
        [
            0.03921569,
            0.39607843,
            0.54509804,
            0.63529412,
            0.76862745,
            0.84313725,
            0.87058824,
            0.86666667,
            0.8745098,
            0.89803922,
            0.89411765,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.89803922,
            0.89803922,
            0.89411765,
            0.89803922,
            0.88627451,
            0.8745098,
            0.89019608,
            0.88235294,
            0.85098039,
            0.80784314,
            0.77647059,
            0.75686275,
            0.17647059,
        ],
        [
            0.01176471,
            0.36470588,
            0.54117647,
            0.64313725,
            0.77647059,
            0.84705882,
            0.8745098,
            0.8627451,
            0.8745098,
            0.89803922,
            0.89411765,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.89411765,
            0.90196078,
            0.89411765,
            0.89411765,
            0.88627451,
            0.86666667,
            0.88235294,
            0.87843137,
            0.84313725,
            0.79215686,
            0.75294118,
            0.69019608,
            0.12156863,
        ],
        [
            0.00392157,
            0.30588235,
            0.53333333,
            0.65098039,
            0.77647059,
            0.84705882,
            0.8745098,
            0.85490196,
            0.87843137,
            0.89803922,
            0.89019608,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.89803922,
            0.90196078,
            0.89411765,
            0.89019608,
            0.87843137,
            0.85882353,
            0.87058824,
            0.87058824,
            0.83529412,
            0.77647059,
            0.72941176,
            0.60784314,
            0.05882353,
        ],
        [
            0.0,
            0.20784314,
            0.46666667,
            0.63529412,
            0.77254902,
            0.84313725,
            0.8745098,
            0.84705882,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89803922,
            0.90196078,
            0.89411765,
            0.88627451,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.87843137,
            0.85098039,
            0.8627451,
            0.8745098,
            0.83137255,
            0.76078431,
            0.67843137,
            0.4745098,
            0.00392157,
        ],
        [
            0.0,
            0.01568627,
            0.29803922,
            0.56862745,
            0.74901961,
            0.83137255,
            0.86666667,
            0.83921569,
            0.8745098,
            0.89019608,
            0.89019608,
            0.89803922,
            0.89803922,
            0.89019608,
            0.88235294,
            0.89411765,
            0.89803922,
            0.89019608,
            0.87843137,
            0.87058824,
            0.83529412,
            0.84705882,
            0.85882353,
            0.81176471,
            0.71372549,
            0.58039216,
            0.27843137,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.12156863,
            0.50980392,
            0.72941176,
            0.82745098,
            0.85098039,
            0.81960784,
            0.87058824,
            0.89019608,
            0.89019608,
            0.89803922,
            0.90196078,
            0.89019608,
            0.88235294,
            0.89019608,
            0.89411765,
            0.88627451,
            0.8745098,
            0.86666667,
            0.81960784,
            0.81960784,
            0.84313725,
            0.78823529,
            0.65882353,
            0.43529412,
            0.03921569,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.39607843,
            0.68627451,
            0.81176471,
            0.82745098,
            0.79607843,
            0.85490196,
            0.87843137,
            0.88235294,
            0.89411765,
            0.89411765,
            0.88627451,
            0.8745098,
            0.88235294,
            0.88627451,
            0.87843137,
            0.8627451,
            0.85098039,
            0.8,
            0.78431373,
            0.82352941,
            0.76078431,
            0.6,
            0.2627451,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.28235294,
            0.62745098,
            0.78823529,
            0.79607843,
            0.75686275,
            0.83921569,
            0.8627451,
            0.87058824,
            0.88235294,
            0.88235294,
            0.87058824,
            0.85882353,
            0.86666667,
            0.8745098,
            0.86666667,
            0.85098039,
            0.83529412,
            0.76470588,
            0.74117647,
            0.8,
            0.72156863,
            0.48235294,
            0.00784314,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.03529412,
            0.55686275,
            0.75686275,
            0.78431373,
            0.72156863,
            0.83529412,
            0.88627451,
            0.90588235,
            0.93333333,
            0.94117647,
            0.9254902,
            0.90980392,
            0.9254902,
            0.93333333,
            0.91372549,
            0.88235294,
            0.83529412,
            0.72941176,
            0.69411765,
            0.77254902,
            0.6627451,
            0.35686275,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.14509804,
            0.34901961,
            0.34117647,
            0.23921569,
            0.35686275,
            0.45490196,
            0.54117647,
            0.61176471,
            0.62352941,
            0.58823529,
            0.57647059,
            0.59215686,
            0.60784314,
            0.58039216,
            0.48235294,
            0.36470588,
            0.23137255,
            0.25490196,
            0.38823529,
            0.27058824,
            0.02352941,
            0.0,
            0.0,
            0.0,
        ],
    ],
    np.int32,
)

m5 = np.array(
    [
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.00392157,
            0.17254902,
            0.48235294,
            0.56862745,
            0.60784314,
            0.6,
            0.59215686,
            0.61568627,
            0.6,
            0.54117647,
            0.39607843,
            0.06666667,
            0.00392157,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.00784314,
            0.17647059,
            0.51764706,
            0.75686275,
            0.88235294,
            0.91764706,
            0.95294118,
            0.95294118,
            0.94901961,
            0.96078431,
            0.94117647,
            0.89411765,
            0.84705882,
            0.67058824,
            0.38039216,
            0.05882353,
            0.00392157,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.00784314,
            0.34117647,
            0.58823529,
            0.7254902,
            0.81568627,
            0.8745098,
            0.8745098,
            0.88235294,
            0.89019608,
            0.89411765,
            0.88627451,
            0.8745098,
            0.86666667,
            0.8627451,
            0.78431373,
            0.69411765,
            0.55294118,
            0.22745098,
            0.00392157,
            0.0,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.00392157,
            0.23921569,
            0.58431373,
            0.71764706,
            0.79607843,
            0.84705882,
            0.87843137,
            0.86666667,
            0.8745098,
            0.88627451,
            0.88627451,
            0.87843137,
            0.87058824,
            0.86666667,
            0.87058824,
            0.83137255,
            0.78039216,
            0.70980392,
            0.56078431,
            0.16078431,
            0.00392157,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.00784314,
            0.47843137,
            0.71372549,
            0.79215686,
            0.81960784,
            0.84705882,
            0.8745098,
            0.8627451,
            0.8745098,
            0.87843137,
            0.8745098,
            0.87843137,
            0.87058824,
            0.86666667,
            0.87058824,
            0.84705882,
            0.82745098,
            0.79215686,
            0.70588235,
            0.44705882,
            0.02352941,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.15294118,
            0.62352941,
            0.78039216,
            0.80784314,
            0.83137255,
            0.85098039,
            0.87058824,
            0.85882353,
            0.86666667,
            0.87058824,
            0.8745098,
            0.8745098,
            0.86666667,
            0.86666667,
            0.8745098,
            0.85490196,
            0.83921569,
            0.82352941,
            0.77647059,
            0.63137255,
            0.3254902,
            0.01176471,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.34117647,
            0.69411765,
            0.80784314,
            0.82352941,
            0.83921569,
            0.85098039,
            0.8627451,
            0.85882353,
            0.8627451,
            0.87058824,
            0.87843137,
            0.87843137,
            0.87058824,
            0.87058824,
            0.8745098,
            0.8627451,
            0.85098039,
            0.84313725,
            0.81568627,
            0.7372549,
            0.56078431,
            0.23137255,
            0.00392157,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.00392157,
            0.44705882,
            0.7372549,
            0.82745098,
            0.83921569,
            0.84705882,
            0.85098039,
            0.8627451,
            0.85882353,
            0.86666667,
            0.87058824,
            0.8745098,
            0.88627451,
            0.87058824,
            0.87058824,
            0.87058824,
            0.86666667,
            0.86666667,
            0.85882353,
            0.83529412,
            0.78039216,
            0.68235294,
            0.48627451,
            0.02352941,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.04313725,
            0.54901961,
            0.76470588,
            0.83529412,
            0.85882353,
            0.85490196,
            0.85098039,
            0.8627451,
            0.8627451,
            0.8627451,
            0.87058824,
            0.86666667,
            0.89019608,
            0.87843137,
            0.8745098,
            0.8745098,
            0.8745098,
            0.87843137,
            0.8745098,
            0.85490196,
            0.80784314,
            0.7372549,
            0.61960784,
            0.16862745,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.1254902,
            0.59215686,
            0.78431373,
            0.84313725,
            0.87058824,
            0.86666667,
            0.85490196,
            0.86666667,
            0.8627451,
            0.87058824,
            0.8745098,
            0.86666667,
            0.89411765,
            0.88627451,
            0.88235294,
            0.87843137,
            0.87843137,
            0.88627451,
            0.88235294,
            0.86666667,
            0.81960784,
            0.76470588,
            0.69411765,
            0.30588235,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.15686275,
            0.60784314,
            0.79607843,
            0.84313725,
            0.87843137,
            0.8745098,
            0.85882353,
            0.87058824,
            0.86666667,
            0.87843137,
            0.87843137,
            0.87058824,
            0.89803922,
            0.88627451,
            0.88627451,
            0.88627451,
            0.88235294,
            0.89019608,
            0.88627451,
            0.87058824,
            0.83137255,
            0.78431373,
            0.74509804,
            0.45882353,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.1254902,
            0.58431373,
            0.79607843,
            0.83529412,
            0.8745098,
            0.8745098,
            0.8627451,
            0.8745098,
            0.87058824,
            0.88627451,
            0.87843137,
            0.87058824,
            0.89803922,
            0.88627451,
            0.89019608,
            0.89019608,
            0.89019608,
            0.89411765,
            0.89019608,
            0.87058824,
            0.83529412,
            0.79607843,
            0.78039216,
            0.58823529,
            0.00392157,
        ],
        [
            0.0,
            0.0,
            0.00392157,
            0.14509804,
            0.61568627,
            0.8,
            0.83921569,
            0.8745098,
            0.87058824,
            0.86666667,
            0.88235294,
            0.87843137,
            0.89019608,
            0.88235294,
            0.87843137,
            0.89803922,
            0.89019608,
            0.89019608,
            0.89411765,
            0.89019608,
            0.90196078,
            0.89803922,
            0.87843137,
            0.85490196,
            0.80784314,
            0.79607843,
            0.69019608,
            0.04313725,
        ],
        [
            0.0,
            0.0,
            0.00784314,
            0.21568627,
            0.63529412,
            0.81176471,
            0.84313725,
            0.87843137,
            0.87058824,
            0.8745098,
            0.88235294,
            0.87843137,
            0.89019608,
            0.88235294,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89019608,
            0.89803922,
            0.89019608,
            0.89803922,
            0.89803922,
            0.88235294,
            0.85882353,
            0.81176471,
            0.79607843,
            0.74117647,
            0.10196078,
        ],
        [
            0.0,
            0.00784314,
            0.09411765,
            0.38431373,
            0.68627451,
            0.82352941,
            0.85490196,
            0.87843137,
            0.8627451,
            0.87843137,
            0.88627451,
            0.88235294,
            0.89411765,
            0.88627451,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89019608,
            0.89411765,
            0.88627451,
            0.89019608,
            0.89411765,
            0.87843137,
            0.85882353,
            0.81568627,
            0.8,
            0.77254902,
            0.15294118,
        ],
        [
            0.00392157,
            0.17254902,
            0.36470588,
            0.54117647,
            0.72941176,
            0.83137255,
            0.85490196,
            0.8745098,
            0.8627451,
            0.88235294,
            0.89019608,
            0.88627451,
            0.89411765,
            0.88627451,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89019608,
            0.89803922,
            0.88627451,
            0.89411765,
            0.89803922,
            0.88235294,
            0.8627451,
            0.81960784,
            0.8,
            0.80392157,
            0.2,
        ],
        [
            0.03529412,
            0.34901961,
            0.4745098,
            0.6,
            0.74901961,
            0.83921569,
            0.8627451,
            0.87058824,
            0.8627451,
            0.89019608,
            0.89019608,
            0.88627451,
            0.89411765,
            0.88627451,
            0.88627451,
            0.90196078,
            0.89803922,
            0.89411765,
            0.90196078,
            0.89019608,
            0.88627451,
            0.89803922,
            0.89019608,
            0.86666667,
            0.81568627,
            0.79607843,
            0.80784314,
            0.21568627,
        ],
        [
            0.07843137,
            0.42745098,
            0.54901961,
            0.64313725,
            0.77647059,
            0.84705882,
            0.87058824,
            0.87058824,
            0.87058824,
            0.89411765,
            0.89019608,
            0.89019608,
            0.89803922,
            0.89019608,
            0.88235294,
            0.89803922,
            0.89803922,
            0.89019608,
            0.89803922,
            0.88627451,
            0.87843137,
            0.89019608,
            0.88627451,
            0.85490196,
            0.81176471,
            0.78431373,
            0.78039216,
            0.2,
        ],
        [
            0.03921569,
            0.39607843,
            0.54509804,
            0.63529412,
            0.76862745,
            0.84313725,
            0.87058824,
            0.86666667,
            0.8745098,
            0.89803922,
            0.89411765,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.89803922,
            0.89803922,
            0.89411765,
            0.89803922,
            0.88627451,
            0.8745098,
            0.89019608,
            0.88235294,
            0.85098039,
            0.80784314,
            0.77647059,
            0.75686275,
            0.17647059,
        ],
        [
            0.01176471,
            0.36470588,
            0.54117647,
            0.64313725,
            0.77647059,
            0.84705882,
            0.8745098,
            0.8627451,
            0.8745098,
            0.89803922,
            0.89411765,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.89411765,
            0.90196078,
            0.89411765,
            0.89411765,
            0.88627451,
            0.86666667,
            0.88235294,
            0.87843137,
            0.84313725,
            0.79215686,
            0.75294118,
            0.69019608,
            0.12156863,
        ],
        [
            0.00392157,
            0.30588235,
            0.53333333,
            0.65098039,
            0.77647059,
            0.84705882,
            0.8745098,
            0.85490196,
            0.87843137,
            0.89803922,
            0.89019608,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.89803922,
            0.90196078,
            0.89411765,
            0.89019608,
            0.87843137,
            0.85882353,
            0.87058824,
            0.87058824,
            0.83529412,
            0.77647059,
            0.72941176,
            0.60784314,
            0.05882353,
        ],
        [
            0.0,
            0.20784314,
            0.46666667,
            0.63529412,
            0.77254902,
            0.84313725,
            0.8745098,
            0.84705882,
            0.87843137,
            0.89803922,
            0.89411765,
            0.89803922,
            0.90196078,
            0.89411765,
            0.88627451,
            0.89411765,
            0.89803922,
            0.89019608,
            0.88627451,
            0.87843137,
            0.85098039,
            0.8627451,
            0.8745098,
            0.83137255,
            0.76078431,
            0.67843137,
            0.4745098,
            0.00392157,
        ],
        [
            0.0,
            0.01568627,
            0.29803922,
            0.56862745,
            0.74901961,
            0.83137255,
            0.86666667,
            0.83921569,
            0.8745098,
            0.89019608,
            0.89019608,
            0.89803922,
            0.89803922,
            0.89019608,
            0.88235294,
            0.89411765,
            0.89803922,
            0.89019608,
            0.87843137,
            0.87058824,
            0.83529412,
            0.84705882,
            0.85882353,
            0.81176471,
            0.71372549,
            0.58039216,
            0.27843137,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.12156863,
            0.50980392,
            0.72941176,
            0.82745098,
            0.85098039,
            0.81960784,
            0.87058824,
            0.89019608,
            0.89019608,
            0.89803922,
            0.90196078,
            0.89019608,
            0.88235294,
            0.89019608,
            0.89411765,
            0.88627451,
            0.8745098,
            0.86666667,
            0.81960784,
            0.81960784,
            0.84313725,
            0.78823529,
            0.65882353,
            0.43529412,
            0.03921569,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.39607843,
            0.68627451,
            0.81176471,
            0.82745098,
            0.79607843,
            0.85490196,
            0.87843137,
            0.88235294,
            0.89411765,
            0.89411765,
            0.88627451,
            0.8745098,
            0.88235294,
            0.88627451,
            0.87843137,
            0.8627451,
            0.85098039,
            0.8,
            0.78431373,
            0.82352941,
            0.76078431,
            0.6,
            0.2627451,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.28235294,
            0.62745098,
            0.78823529,
            0.79607843,
            0.75686275,
            0.83921569,
            0.8627451,
            0.87058824,
            0.88235294,
            0.88235294,
            0.87058824,
            0.85882353,
            0.86666667,
            0.8745098,
            0.86666667,
            0.85098039,
            0.83529412,
            0.76470588,
            0.74117647,
            0.8,
            0.72156863,
            0.48235294,
            0.00784314,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.03529412,
            0.55686275,
            0.75686275,
            0.78431373,
            0.72156863,
            0.83529412,
            0.88627451,
            0.90588235,
            0.93333333,
            0.94117647,
            0.9254902,
            0.90980392,
            0.9254902,
            0.93333333,
            0.91372549,
            0.88235294,
            0.83529412,
            0.72941176,
            0.69411765,
            0.77254902,
            0.6627451,
            0.35686275,
            0.0,
            0.0,
            0.0,
        ],
        [
            0.0,
            0.0,
            0.0,
            0.0,
            0.14509804,
            0.34901961,
            0.34117647,
            0.23921569,
            0.35686275,
            0.45490196,
            0.54117647,
            0.61176471,
            0.62352941,
            0.58823529,
            0.57647059,
            0.59215686,
            0.60784314,
            0.58039216,
            0.48235294,
            0.36470588,
            0.23137255,
            0.25490196,
            0.38823529,
            0.27058824,
            0.02352941,
            0.0,
            0.0,
            0.0,
        ],
    ],
    np.int32,
)


def test_user_id_hashes() -> None:
    sample_user_id = str(uuid.uuid4())
    assert hash_user_id(sample_user_id) == hash_user_id(sample_user_id)
    assert hash_user_id(sample_user_id, assignment_id=1) == hash_user_id(
        sample_user_id, assignment_id=1
    )
    assert hash_user_id(sample_user_id, assignment_id=2) != hash_user_id(
        sample_user_id, assignment_id=1
    )
    n = 1000
    for _ in range(1000):
        a, b = str(uuid.uuid4()), str(uuid.uuid4())
        if a != b and hash_user_id(a) != hash_user_id(b):
            return
    pytest.fail(
        f"Could not find different hashes for different inputs within {n} attempts"
    )


def test_hash_is_injective() -> None:
    assert hash_matrix(m1_0) == hash_matrix(m1_1)
    assert hash_matrix(m4) == hash_matrix(m5)


def test_hash_respects_order() -> None:
    assert hash_matrix(m1_1) != hash_matrix(m2)
    assert hash_matrix(m1_1) != hash_matrix(m3)


def test_hash_respects_type() -> None:
    assert hash_matrix(m1_1) != hash_matrix(m1_float)


def test_mnist() -> None:
    fashion_mnist = keras.datasets.fashion_mnist
    _, (test_images, test_labels) = fashion_mnist.load_data()

    fashion_mnist2 = keras.datasets.fashion_mnist
    _, (test_images2, test_labels2) = fashion_mnist2.load_data()

    fashion_mnist3 = keras.datasets.fashion_mnist
    _, (test_images3, test_labels3) = fashion_mnist3.load_data()

    assert (test_images == test_images2).all()
    assert (test_images3 == test_images2).all()

    sorted1, sorted2, sorted3 = (
        np.sort(test_images, axis=0),
        np.sort(test_images2, axis=0),
        np.sort(test_images3, axis=0),
    )
    assert (sorted1 == sorted2).all()
    assert (sorted3 == sorted2).all()

    index = 500
    assert (sorted1[index] == sorted2[index]).all()
    assert (sorted3[index] == sorted2[index]).all()

    assert hash_matrix(sorted1[index]) == hash_matrix(sorted2[index])
    assert hash_matrix(sorted3[index]) == hash_matrix(sorted2[index])


def test_preserves_predictions() -> None:
    m = np.array([[1.0, 2.0, 3.0], [4.0, 5.0, 6.0]], np.int32)

    assert (m == np.asarray(m.tolist())).all()
    assert m.shape == np.asarray(m.tolist()).shape
